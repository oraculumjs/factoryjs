/* FactoryJS 1.1.9 */
(function(){var a=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};define(["underscore","jquery","backbone"],function(c,d,e){var f,g,h,i,j;return i=function(b,c,d,e){return e.__type=function(){return c},e.__factory=function(){return b},e.__activeMixins=function(){return[]},e.__tags=function(){return b.getTags(e)},e.__mixins=function(){return b.composeMixinDependencies(null!=d?d.mixins:void 0)},e.__singleton=function(){return Boolean(d.singleton)},e.__mixin=function(){return b.applyMixin.apply(b,[e].concat(a.call(arguments)))},e.__dispose=function(){return b.disposeInstance.apply(b,[e].concat(a.call(arguments)))}},g=function(){var b,d,e;return d=arguments[0],e=arguments[1],b=3<=arguments.length?a.call(arguments,2):[],c.isFunction(d)&&(d=d.apply(this,b)),c.isFunction(e)&&(e=e.apply(this,b)),null==e?c.clone(d):c.isArray(d)&&c.isArray(e)?[].concat(d,e):c.extend({},d,e)},h=function(){var b,d;return b=arguments[0],d=2<=arguments.length?a.call(arguments,1):[],c.reduce(d,function(b,d){return c.isFunction(b)||c.isFunction(d)?function(){return g.call.apply(g,[this,b,d].concat(a.call(arguments)))}:g(b,d)},b)},j=function(a,b){var d,e,f,g;null==a&&(a={}),null==b&&(b={}),f=[];for(e in b)d=b[e],g=null!=a[e]?a[e]:a[e]=d,g!==d?c.isObject(g)&&c.isObject(d)?c.isDate(g)||c.isDate(d)||c.isElement(g)||c.isElement(d)||c.isRegExp(g)||c.isRegExp(d)||f.push(a[e]=h(d,g)):(a[e]=g,null==a[e]&&(a[e]=d)):d.constructor===Object&&(a[e]=c.clone(g));return f},f=function(){function f(a,b){null==b&&(b={}),this.mixins={},this.tagMap={},this.promises={},this.instances={},this.mirrors=[],this.definitions={},this.tagCallbacks={},this.baseTags=b.baseTags||[],this.on("create",function(a){return function(){return a.handleCreate.apply(a,arguments)}}(this)),this.on("define",function(a){return function(){return a.handleDefine.apply(a,arguments)}}(this)),this.define("Base",a)}return c.extend(f.prototype,e.Events),f.COMMIT="<%- gitinfo.local.branch.current.SHA %>",f.VERSION="<%- component.version %>",f.enhanceObject=i,f.composeConfig=h,f.extendMixinOptions=j,c.extend(f.prototype,{enhanceObject:i,composeConfig:h,extendMixinOptions:j}),f.prototype.define=function(a,b,d){var e,f,g;if(null==d&&(d={}),null!=(e=this.getDefinition(a))&&!d.override){if(d.silent)return this;throw f=e.factory,new Error('Factory#define Definition "'+a+'" already exists.\nDefinition exists in factory tagged with '+f.baseTags+".\nUse `override` to replace this definition in the current factory.")}return this.whenDefined(a),g={options:d},c.isFunction(b)?g.constructor=b:g.constructor=function(){return c.clone(b)},g.tags=c.chain([a]).union(d.tags).union(this.baseTags).compact().uniq().value(),this.definitions[a]=g,this.trigger("define",a,g,d,this),this},f.prototype.extend=function(a,b,d,f){var g,h,i,k,l,m;if(null==f&&(f={}),m=this._getDefinitionSpec(a),g=m.definition,h=m.factory,!c.isObject(d))throw new TypeError("Factory#extend Invalid Argument.\n`definition` must be an Object.");return f.tags=c.chain([]).union(f.tags).union(g.tags).union(h.baseTags).compact().uniq().value(),f.inheritMixins&&(f.mixins=c.chain([]).union(g.options.mixins).union(f.mixins).compact().uniq().value(),l=g.constructor.prototype.mixinOptions,j(d.mixinOptions,l)),Boolean(f.singleton)?f.singleton=Boolean(f.singleton):f.singleton=Boolean(g.options.singleton),i=g.constructor.extend||e.Model.extend,k=i.call(g.constructor,d),this.define(b,k,f)},f.prototype.hasDefinition=function(a){return null!=this.getDefinition(a)},f.prototype.getDefinition=function(a){var b,c,d,e,f,g;if(null!=(b=this.definitions[a]))return c={definition:b,factory:this};for(g=this.mirrors,e=0,f=g.length;f>e;e++)if(d=g[e],null!=(c=d.getDefinition(a)))return c},f.prototype._getDefinitionSpec=function(a){var b;if(null==(b=this.getDefinition(a)))throw new ReferenceError("Factory#_getDefinitionSpec Definition "+a+" does not exist.");return b},f.prototype.fetchDefinition=function(a){return require([a],function(b){return function(c){return b.define(a,c)}}(this)),this.whenDefined(a)},f.prototype.whenDefined=function(a){var b;return null!=(b=this.promises)[a]?b[a]:b[a]=d.Deferred()},f.prototype.getConstructor=function(b,c){var d,e,f,g;return null==c&&(c=!1),g=this._getDefinitionSpec(b),e=g.definition,f=g.factory,c?e.constructor:(d=function(c){return function(){return c.getInstance.apply(c,[b].concat(a.call(arguments)))}}(this),d.prototype=e.constructor.prototype,d)},f.prototype.get=function(){return this.getInstance.apply(this,arguments)},f.prototype.getInstance=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n;return j=arguments[0],c=2<=arguments.length?a.call(arguments,1):[],h=null!=(l=this._getFirstInstanceFromMemory(j))?l.instance:void 0,h&&("function"==typeof h.__singleton?h.__singleton():void 0)?h:(m=this._getDefinitionSpec(j),e=m.definition,f=m.factory,k=e.options,i=k.mixins||[],n=Boolean(k.singleton),g=k.injections||[],b=e.constructor,this.enhanceObject(this,j,k,b.prototype),h=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(b,c,function(){}),this.enhanceObject(this,j,k,h),h.constructor=f.getConstructor(j),null==(d=this.instances)[j]&&(d[j]=[]),this.instances[j].push(h),this.handleDefine(j,e,{ignore_promise:!0}),this.handleMixins(h,i,c),this.handleInjections(h,g),this.handleTags(j,h,e.tags),"function"==typeof h.constructed&&h.constructed.apply(h,c),this.trigger.apply(this,["create",j,h].concat(a.call(c))),h)},f.prototype._getFirstInstanceFromMemory=function(a){var b,c,d,e,f,g,h;if(null!=(d=null!=(g=this.instances[a])?g[0]:void 0))return e={instance:d,factory:this};for(h=this.mirrors,c=0,f=h.length;f>c;c++)if(b=h[c],null!=(e=b._getFirstInstanceFromMemory(a)))return e},f.prototype.resolveInstance=function(){var b,d;return d=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],c.isFunction(d)&&(d=d.call.apply(d,[this].concat(a.call(b)))),c.isString(d)&&(d=this.getInstance.apply(this,[d].concat(a.call(b)))),d},f.prototype.defineMixin=function(a,b,c){var d,e;if(null==c&&(c={}),null!=(d=this.getMixin(a))&&!c.override){if(c.silent)return this;throw e=d.factory,new Error('Factory#defineMixin Mixin "'+a+'" already exists.\nMixin exists in factory tagged with '+e.baseTags+".\nUse `override` to replace this mixin in the current factory.")}return this.mixins[a]={definition:b,options:c},this.trigger("defineMixin",a,b,c),this},f.prototype.hasMixin=function(a){return null!=this.getMixin(a)},f.prototype.getMixin=function(a){var b,c,d,e,f,g;if(null!=(e=this.mixins[a]))return f={mixin:e,factory:this};for(g=this.mirrors,c=0,d=g.length;d>c;c++)if(b=g[c],null!=(f=b.getMixin(a)))return f},f.prototype._getMixinSpec=function(a){var b;if(null==(b=this.getMixin(a)))throw new ReferenceError("Factory#_getMixin Mixin "+a+" does not exist.");return b},f.prototype.composeMixinDependencies=function(a){return null==a&&(a=[]),c.chain(a).reduce(function(a){return function(b,c){var d,e,f;return e=a._getMixinSpec(c),d=null!=(f=e.mixin.options)?f.mixins:void 0,null!=d&&(b=b.concat(a.composeMixinDependencies(d))),b.push(c),b}}(this),[]).compact().uniq().value()},f.prototype.applyMixin=function(a,d,e){var f,g,h,i,k,l,m,n,o,p,q,r,s;if(a.mixinOptions=c.extend({},a.mixinOptions),p=this._getMixinSpec(d),n=p.mixin,h=p.factory,b.call(a.__mixins(),d)<0&&(l=!0,k=!0),!(b.call(a.__activeMixins(),d)>=0)){if((o=null!=(q=n.options)?q.mixins:void 0)&&l)for(r=this.composeMixinDependencies(o),i=0,m=r.length;m>i;i++)g=r[i],this.applyMixin(a,g);return null==(null!=(s=n.options)?s.tags:void 0)||k||(a.____tags||(a.____tags=[]),a.____tags=a.____tags.concat(n.options.tags)),c.extend(a,c.omit(n.definition,["mixinOptions","mixinitialize","mixconfig"])),f=a.__activeMixins(),f.push(d),a.__activeMixins=function(){return f},l&&(j(a.mixinOptions,n.definition.mixinOptions),this.mixconfig(a,d,e),this.mixinitialize(a,d,e)),a}},f.prototype.mixconfig=function(b,c,d){var e,f,g,h,i;return i=this._getMixinSpec(c),h=i.mixin,g=i.factory,(null!=d?d.length:void 0)>0?"function"==typeof(e=h.definition).mixconfig?e.mixconfig.apply(e,[b.mixinOptions].concat(a.call(d))):void 0:"function"==typeof(f=h.definition).mixconfig?f.mixconfig(b.mixinOptions):void 0},f.prototype.mixinitialize=function(a,b,c){var d,e,f,g,h;return f=this._getMixinSpec(b),e=f.mixin,d=f.factory,(null!=c?c.length:void 0)>0?null!=(g=e.definition.mixinitialize)?g.apply(a,c):void 0:null!=(h=e.definition.mixinitialize)?h.apply(a):void 0},f.prototype.handleInjections=function(a,b){var c,d,e;e=[];for(d in b)c=b[d],e.push(a[d]=this.getInstance(c));return e},f.prototype.getTags=function(a){var b,d;return d=c.chain(a.__mixins()).map(function(a){return function(b){var c;return null!=(c=a._getMixinSpec(b).mixin.options)?c.tags:void 0}}(this)).flatten().compact().uniq().value(),b=this._getDefinitionSpec(a.__type()).definition.tags,c.chain([]).union(a.____tags).union(b).union(d).compact().uniq().value()},f.prototype.handleDefine=function(a,b,c){var d;return c.ignore_promise?void 0:(d=this.whenDefined(a)).resolve.apply(d,arguments)},f.prototype.handleCreate=function(){var b,d,e;return e=arguments[0],d=arguments[1],b=3<=arguments.length?a.call(arguments,2):[],c.each(d.__tags(),function(a){return function(b){var c,e,f,g,h;if(null!=(e=a.tagCallbacks[b])){for(h=[],f=0,g=e.length;g>f;f++)c=e[f],h.push("function"==typeof c?c(d):void 0);return h}}}(this))},f.prototype.handleMixins=function(a,b,d){var e,f,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w;for(e=c.chain([]).union(a.__mixins()).union(b).compact().uniq().value(),v=this.composeMixinDependencies(e),g=0,l=v.length;l>g;g++)s=v[g],this.applyMixin(a,s);for(t=v.slice().reverse(),h=0,m=t.length;m>h;h++)s=t[h],u=this._getMixinSpec(s),p=u.mixin,f=u.factory,r=a.mixinOptions,q=p.definition.mixinOptions,j(r,q),a.mixinOptions=c.extend({},q,r);for(i=0,n=v.length;n>i;i++)s=v[i],this.mixconfig(a,s,d);for(w=[],k=0,o=v.length;o>k;k++)s=v[k],w.push(this.mixinitialize(a,s));return w},f.prototype.handleTags=function(a,b,d){var e;return delete b.____tags,e=[this.instances[a]],d=b.__tags(),c.each(d,function(a){return function(c){var d,f;return null==(d=a.tagMap)[c]&&(d[c]=[]),null==(f=a.tagCallbacks)[c]&&(f[c]=[]),a.tagMap[c].push(b),e.push(a.tagMap[c])}}(this)),b.__factoryMap=function(){return c.uniq(e)}},f.prototype.mirror=function(b){if(!(b instanceof f))throw new TypeError("Factory#mirror Invalid Argument.\n`factory` must be an instance of Factory.");return this.mirrors.unshift(b),this.baseTags=c.chain(this.baseTags).union(b.baseTags).compact().uniq().value(),this.on("create",function(){return b.trigger.apply(b,["create"].concat(a.call(arguments)))}),this.on("dispose",function(){return b.trigger.apply(b,["dispose"].concat(a.call(arguments)))}),this.listenTo(b,"define",function(b){return function(){return b.trigger.apply(b,["define"].concat(a.call(arguments)))}}(this)),this.listenTo(b,"defineMixin",function(b){return function(){return b.trigger.apply(b,["defineMixin"].concat(a.call(arguments)))}}(this))},f.prototype.dispose=function(a){return null==a?this.disposeFactory:a instanceof f?this.disposeFactory(a):this.disposeInstance(a)},f.prototype.disposeInstance=function(a,c){var d,e,f,g,h;for(null==c&&(c={}),h=a.__factoryMap(),e=0,g=h.length;g>e;e++){if(d=h[e],b.call(d,a)<0){if(c.silent)return this;throw new ReferenceError("Factory#dispose Instance not in Factory.\nInstance does not exist in factory tagged with "+this.baseTags+".\nUse `silent` option to ignore."&&!c.silent)}for(;(f=d.indexOf(a))>-1;)d.splice(f,1)}return this.trigger("dispose",a)},f.prototype.disposeFactory=function(a){null==a&&(a=this)},f.prototype.verifyTags=function(){return this.verifyInstance.apply(this,arguments)},f.prototype.verifyInstance=function(a){var d;return(d="function"==typeof a.__factoryMap?a.__factoryMap():void 0)?c.all(d,function(c){return b.call(c,a)>=0}):!1},f.prototype.onTag=function(a,b){var d;if(!c.isString(a))throw new TypeError("Factory#onTag Invalid Argument.\n`tag` must be a String.");if(!c.isFunction(b))throw new TypeError("Factory#onTag Invalid Argument.\n`callback` must be a Function.");return this._handleTagCallback(a,b),null==(d=this.tagCallbacks)[a]&&(d[a]=[]),this.tagCallbacks[a].push(b),!0},f.prototype._handleTagCallback=function(a,b){var c,d,e,f,g,h,i,j,k;for(i=this.tagMap[a]||[],d=0,g=i.length;g>d;d++)e=i[d],b(e);for(j=this.mirrors,k=[],f=0,h=j.length;h>f;f++)c=j[f],k.push(c._handleTagCallback(a,b));return k},f.prototype.offTag=function(a,b){var d,e;if(!c.isString(a))throw new TypeError("Factory#offTag Invalid Argument.\n`tag` must be a String.");if(null!=(d=this.tagCallbacks[a])){if(0===d.length)return delete this.tagCallbacks[a];if(!c.isFunction(b))return delete this.tagCallbacks[a];if((e=d.indexOf(b))<0)throw new ReferenceError("Factory#offTag Callback Not Found for "+a+".");return d.splice(e,1),0===d.length?delete this.tagCallbacks[a]:void 0}},f}()})}).call(this);